<!doctype html>
<html lang="de-CH">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Geordnete Wildheit – Start</title>
  <meta name="description" content="Seriöser, barrierearmer Auftritt einer Grünen-Politikerin mit lebendigem Kartenraster und klaren Filtern.">
  <style>
    :root{
      --brand:#84B414; --brand-ink:#ffffff; --brand-dark:#5a8f00;
      --bg:#f6f8f5; --paper:#ffffff; --ink:#1a1a1a; --muted:#5d5d5d; --border:#e0e4da; --focus:#0b5fff;
      --ok:#2e7d32; --warn:#c26500; --danger:#b00020;
      --radius:12px; --shadow:0 1px 2px rgba(0,0,0,.05), 0 8px 24px rgba(0,0,0,.08);
      --col-gap:1.25rem; --card-gap:1rem; --maxw:1120px; --header-h:72px;
      --agenda-date-w:330px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:400 17px/1.55 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif;color:var(--ink);background:var(--bg);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    a{color:#0a66c2;text-decoration:none} a:hover{text-decoration:underline}
    img{max-width:100%;height:auto;display:block}

    .skip-link{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{left:1rem;top:1rem;padding:.5rem .75rem;background:#fff;border:2px solid var(--focus);border-radius:6px;z-index:1000}

    :focus{outline:none}
    :focus-visible{outline:3px solid var(--focus);outline-offset:2px}
    .btn:focus-visible,.chip:focus-visible,.search input:focus-visible{box-shadow:0 0 0 3px rgba(11,95,255,.25)}

    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border);backdrop-filter:saturate(1.1) blur(6px)}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 1rem}
    .brandbar{position:relative;display:grid;grid-template-columns:1fr auto;align-items:center;gap:1rem;min-height:var(--header-h)}
    .brand{display:flex;align-items:center;gap:.75rem}
    .brand .mark{width:40px;height:40px;border-radius:10px;background:var(--brand);box-shadow:inset 0 0 0 2px #fff,0 1px 2px rgba(0,0,0,.08)}
    .brand h1{margin:0;font-size:1.1rem;font-weight:700;letter-spacing:.2px}
    .cta{display:flex;gap:.5rem}
    .btn{appearance:none;border:1px solid transparent;border-radius:999px;padding:.6rem .95rem;font-weight:650;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{background:var(--brand-dark);color:var(--brand-ink)} .btn.primary:hover{filter:brightness(.98)}
    .btn.secondary{background:#fff;color:var(--ink);border:1px solid var(--border)}

    /* Hero */
    .hero{background:transparent;border-bottom:none}
    .hero-grid{display:grid;grid-template-columns:1.2fr .8fr;gap:1rem;align-items:center;padding:1.25rem 0}
    .hero h2{margin:.25rem 0 .25rem 0;font-size:1.45rem}
    .hero p{margin:.25rem 0 0 0;color:#2c2c2c;max-width:70ch}
    .hero .tile{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:.9rem}

    /* „Über mich“ – eigene Sektion */
    .about{margin: .25rem 0 0 0;}
    .about-grid{display:grid;grid-template-columns: 1fr 1fr;gap:1rem;align-items:start;padding: .75rem 0}
    .about .tile{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:1rem}
    .about h3{margin:.25rem 0 .35rem 0}
    .about p{margin:.25rem 0}
    .about .portrait{aspect-ratio:3/4;border-radius:12px;object-fit:cover}

    /* Mini-Agenda */
    .mini-agenda{margin-top:.75rem}
    .mini-agenda h3{font-size:1.0rem;margin:.1rem 0 .4rem 0}
    .agenda-list{display:grid;gap:.4rem}
    .agenda-item{display:grid;grid-template-columns:var(--agenda-date-w) 1fr;gap:.6rem;background:#fff;border:1px solid var(--border);border-radius:10px;padding:.55rem .65rem}
    .agenda-date{font-weight:700;white-space:nowrap;font-feature-settings:"tnum" 1}
    .agenda-meta{font-size:.95rem;line-height:1.25}
    .agenda-meta .where{color:#2b2b2b}
    .agenda-cta{margin-top:.35rem;display:flex;gap:.8rem;flex-wrap:wrap}
    .agenda-cta a{font-weight:650}

    /* Filter */
    .filters{display:grid;grid-template-columns:1fr auto auto;gap:.75rem;align-items:end;margin-top:.75rem}
    .search{display:flex;gap:.5rem;align-items:center}
    .search input{width:100%;padding:.65rem .85rem;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:1rem}
    .chips{display:flex;flex-wrap:wrap;gap:.5rem}
    .chip{padding:.45rem .75rem;border:1px solid var(--border);border-radius:999px;background:#fff;color:#222;cursor:pointer;font-size:.95rem}
    .chip[aria-pressed="true"]{background:var(--brand-dark);color:var(--brand-ink);border-color:transparent}

    /* Karten zeilenweise (Grid) */
    .masonry{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:var(--col-gap);align-items:start;margin:1rem auto 2rem auto}
    .card{break-inside:avoid;background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);margin:0;box-shadow:var(--shadow);overflow:hidden;width:100%;display:inline-block}
    .card .body{padding:.95rem .95rem 1rem .95rem}
    .card h3{margin:.1rem 0 .35rem 0;font-size:1.1rem;line-height:1.3}
    .meta{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;margin:.25rem 0 .6rem 0}
    .label{font-size:.78rem;padding:.25rem .55rem;border-radius:999px;border:1px solid var(--border);background:#fff;color:#333}
    .label.status-entwurf{background:#f6fae9;border-color:#dfecc2}
    .label.status-inarbeit{background:#eef7ee;border-color:#cfe6cf}
    .label.status-beschlossen{background:#eef4ff;border-color:#ccdbff}
    .label.them{background:#f1f7ea}
    .label.region{background:#f4f6f8}
    .label.date{background:#fff;color:var(--muted)}
    .body p{margin:.25rem 0 .55rem 0}
    .body .next{margin-top:.55rem;font-size:.95rem;color:#1f3d1f}
    .actions{display:flex;gap:.5rem;padding:.75rem .95rem;border-top:1px solid var(--border);background:#fafbfc}
    .actions .ghost{appearance:none;background:#fff;border:1px solid var(--border);border-radius:8px;padding:.48rem .7rem;font-size:.95rem;cursor:pointer}

    /* Zeitspur (nicht aktiv im DOM) */
    .zeitspur{display:flex;gap:.6rem;overflow:auto;padding:.6rem .25rem 0 .25rem;scroll-snap-type:x mandatory}
    .zeitspur .pill{flex:0 0 auto;min-width:220px;scroll-snap-align:start;background:#fff;border:1px solid var(--border);border-radius:999px;padding:.5rem .8rem;box-shadow:var(--shadow);font-size:.9rem}

    footer{border-top:1px solid var(--border);background:#fff}
    .transparenz{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));padding:1rem 0}
    .tcard{background:#fff;border:1px solid var(--border);border-radius:var(--radius);padding:.8rem;box-shadow:var(--shadow)}
    .small{color:var(--muted);font-size:.9rem}
    .tlist{margin:.5rem 0 0 0;padding-left:1.1rem} .tlist li{margin:.25rem 0}

    .hero-portrait img{width:100%;height:auto;display:block;border-radius:12px;object-fit:cover;aspect-ratio:3/4}
    .card .media img{width:100%;height:auto;display:block;aspect-ratio:16/9;object-fit:cover}
    .card .media.square img{aspect-ratio:1/1}

    @media print{
      body{background:#fff;color:#000}
      .hero,.about,.filters,.actions,.zeitspur{display:none !important}
      .masonry{grid-template-columns:repeat(2,1fr) !important}
      .card{border-color:#000;box-shadow:none}
      .label{background:#fff !important;border-color:#000;color:#000}
      a{color:#000;text-decoration:underline}
    }

    /* Partei-Badge */
    .party-badge{position:absolute;right:0;top:12px;z-index:60;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:.35rem;display:flex;align-items:center}
    .party-badge img{height:28px;width:auto;display:block;image-rendering:auto}
    @media(max-width:720px){.party-badge{position:static;margin:.5rem 0 0 0} header .brandbar{grid-template-columns:auto auto}}

    .brandbar.badge-collide{padding-right:112px}
    @media(max-width:720px){.brandbar.badge-collide{padding-right:0}}
    .filters{display:grid;grid-template-columns:auto auto 1fr;gap:.75rem;align-items:end;margin-top:.75rem}

    @media(max-width:720px){
      .hero-grid{grid-template-columns:1fr;gap:.75rem;padding:.8rem 0}
      .hero .tile{padding:.75rem}
      .hero h2{font-size:1.25rem;line-height:1.25}
      .hero p{font-size:1rem}
      .cta .btn{padding:.5rem .8rem;font-weight:600}
      .brandbar{align-items:start}
      .filters{grid-template-columns:1fr;gap:.6rem;align-items:stretch}
      .search input{padding:.6rem .8rem}
      .chips{overflow:auto;gap:.45rem;padding-bottom:.25rem;scroll-snap-type:x mandatory}
      .chips .chip{flex:0 0 auto;scroll-snap-align:start}
      .chips::-webkit-scrollbar{display:none}
      .masonry{margin:.5rem auto 1.25rem auto}
      body{padding-bottom:max(env(safe-area-inset-bottom),0px)}
      .agenda-item{grid-template-columns:1fr}
      .about-grid{grid-template-columns:1fr}
    }

    .agenda-cta a{color:#3f6b00;text-decoration:underline;line-height:2.2}
    .agenda-cta a:hover{color:#2f5200}
    .agenda-cta a:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Zum Inhalt springen</a>

  <header role="banner">
    <div class="wrap brandbar badge-collide">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <h1>Geordnete Wildheit</h1>
      </div>
      <nav class="cta" aria-label="Hauptaktionen">
        <a class="btn secondary" href="#ueber-mich" aria-label="Über mich">Über mich</a>
        <button class="btn primary" id="mitmachenBtn" aria-label="Mitmachen">Mitmachen</button>
        <button class="btn secondary" id="newsletterBtn" aria-label="Newsletter">Newsletter</button>
      </nav>

      <div class="party-badge" aria-hidden="true">
        <img src="https://grueneaargau.ch/wp-content/uploads/sites/2/2020/06/Gruene_AG_Logo_RGB-e1591108033630-2560x0-c-default.png" alt="" role="presentation" loading="lazy"
             onerror="this.onerror=null;this.src='assets/logo-gruene-placeholder.svg';">
      </div>
    </div>
  </header>

  <main id="main" class="wrap" role="main">
    <!-- Hero -->
    <section class="hero" aria-label="Einstieg">
      <div class="hero-grid wrap">
        <div>
          <h2>„Politik, die wirkt. Heute Entscheidungen treffen, die morgen tragen.“</h2>
          <p>Schwerpunkt: <strong>Bildung</strong>, <strong>Verkehr</strong>, <strong>Energie</strong>. Transparent, nachvollziehbar, messbar.</p>
          <div class="mini-agenda" aria-label="Nächste Termine in Brugg">
            <h3>Nächste Termine in Brugg</h3>
            <div id="miniAgenda" class="agenda-list" aria-live="polite"></div>
          </div>
        </div>
        <div class="tile hero-portrait" aria-label="Porträt">
          <img src="assets/julia-grieder-portraet.png" alt="Julia Grieder, Brugg – Porträt am Aareufer." loading="eager">
        </div>
      </div>
    </section>

    <!-- Über mich (eigene Sektion) -->
    <section id="ueber-mich" class="about" aria-label="Über mich">
      <div class="about-grid wrap">
        <div class="tile">
          <h3>Über mich</h3>
          <p>Ich heisse <strong>Julia Grieder</strong> und lebe in Brugg. Ich arbeite an Lösungen in <strong>Bildung</strong>, <strong>Verkehr</strong> und <strong>Energie</strong> – konkret vor Ort, nachvollziehbar und messbar.</p>
          <p><em>Nächster Schritt:</em> Sprechstunde jeweils Donnerstag 18–19 Uhr (Ort folgt).</p>
        </div>
        <div class="tile">
          <img class="portrait" src="assets/julia-grieder-quad.jpg" alt="" loading="lazy">
        </div>
      </div>
    </section>

    <!-- Filterzeile -->
    <section class="filters" aria-label="Filter und Suche">
      <div class="chips" id="themes" role="group" aria-label="Themen"></div>
      <div class="chips" id="status" role="group" aria-label="Status"></div>
      <div class="search"><input id="search" type="search" placeholder="Suche"></div>
    </section>

    <!-- Kartenraster -->
    <section class="masonry" id="masonry" aria-live="polite" aria-busy="false"></section>
  </main>

  <footer role="contentinfo">
    <div class="wrap transparenz">
      <div class="tcard">
        <h3>Transparenz</h3>
        <p class="small">Quellen, Abstimmungsverhalten, Sitzungstermine. Veröffentlichung quartalsweise.</p>
        <ul id="transparencyList" class="tlist" aria-label="Belege und Quellen"></ul>
      </div>
      <div class="tcard">
        <h3>Was als Nächstes kommt</h3>
        <p class="small">Energie-Leitfaden Gemeinde, Dossier „Mobilität sicher & flüssig“, Bildung: Entlastung Lehrpersonen.</p>
      </div>
      <div class="tcard">
        <h3>Kontakt</h3>
        <p class="small">Anliegen kurz schildern. Antwort in der Regel binnen 72h.</p>
      </div>
    </div>
  </footer>

  <!-- JSON-LD Events (unverändert) -->
  <script type="application/ld+json" id="events-jsonld">{
    "@context":"https://schema.org","@graph":[
      {"@type":"Event","name":"Veloroute-Spotcheck Ost","startDate":"2025-09-26T18:30:00+02:00","eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode","eventStatus":"https://schema.org/EventScheduled","location":{"@type":"Place","name":"Bahnhof Brugg","address":{"@type":"PostalAddress","addressLocality":"Brugg","addressCountry":"CH"}},"description":"Lückenanalyse und Quick Wins priorisieren.","organizer":{"@type":"Person","name":"Julia Grieder"},"url":"https://example.ch/termine/veloroute-spotcheck-ost"},
      {"@type":"Event","name":"Energieforum Quartier Au","startDate":"2025-10-03T19:00:00+02:00","eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode","eventStatus":"https://schema.org/EventScheduled","location":{"@type":"Place","name":"Schulhaus Au","address":{"@type":"PostalAddress","addressLocality":"Brugg","addressCountry":"CH"}},"description":"Fernwärme und Sozialtarif verständlich erklärt.","organizer":{"@type":"Person","name":"Julia Grieder"},"url":"https://example.ch/termine/energieforum-au"},
      {"@type":"Event","name":"Sprechstunde auf dem Neumarktplatz","startDate":"2025-10-10T12:15:00+02:00","eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode","eventStatus":"https://schema.org/EventScheduled","location":{"@type":"Place","name":"Neumarktplatz Brugg","address":{"@type":"PostalAddress","addressLocality":"Brugg","addressCountry":"CH"}},"description":"Kurze Gespräche zu Bildung, Verkehr, Energie.","organizer":{"@type":"Person","name":"Julia Grieder"},"url":"https://example.ch/termine/sprechstunde-neumarkt"}]}</script>

  <script>
    // Daten
    const DATA = {
      themes: ["Bildung","Verkehr","Energie","Gleichstellung","Digitalisierung","Lokales"],
      status: ["Entwurf","In Arbeit","beschlossen"],
      timeline: [
        { date:"2025-09-18", text:"Kommission Energie: Fernwärme-Netz – Sozialtarif diskutiert" },
        { date:"2025-09-17", text:"Bildung: Gespräch Schulleitungen – Entlastungspaket" },
        { date:"2025-09-16", text:"Mobilität: Veloroute Schule–Bahnhof – Prioritäten gesetzt" }
      ],
      agenda: [
        { date:"2025-09-26", time:"18:30", title:"Veloroute-Spotcheck Ost", place:"Bahnhof Brugg", purpose:"Lückenanalyse / Quick Wins", ctaLabel:"Details", ctaHref:"https://example.ch/termine/veloroute-spotcheck-ost" },
        { date:"2025-10-03", time:"19:00", title:"Energieforum Quartier Au", place:"Schulhaus Au, Brugg", purpose:"Fernwärme & Sozialtarif erklären", ctaLabel:"Details", ctaHref:"https://example.ch/termine/energieforum-au" },
        { date:"2025-10-10", time:"12:15", title:"Sprechstunde Neumarktplatz", place:"Neumarktplatz, Brugg", purpose:"Kurzgespräche zu Bildung/Verkehr/Energie", ctaLabel:"Details", ctaHref:"https://example.ch/termine/sprechstunde-neumarkt" }
      ],
      transparency: [],
      cards: [
        {
          title: "Velorouten in Brugg sicher machen",
          status: "In Arbeit",
          theme: "Verkehr", region: "Brugg",
          date: "2025-09-19",
          media: "assets/julia-grieder-aktion.jpg",
          alt: "Julia Grieder bei einer Begehung der Veloroute in Brugg",
          text: "Lücken zwischen Schule–Bahnhof und Quartier–Zentrum schliessen. Erste Sofortmassnahmen noch vor dem Winter.",
          next: "Begehung mit Tiefbau, Prioritätenliste freigeben."
        },
        {
          title: "Schulen entlasten – Zeit für Lernen statt Formulare",
          status: "beschlossen",
          theme: "Bildung", region: "Kanton Bern",
          date: "2025-09-12",
          text: "Administrationsabbau: Standardisierte Vorlagen, digitale Einreichung, klare Fristen. Monitoring über Q4.",
          next: "Umsetzung prüfen: Rückmeldungen von 30 Schulleitungen bündeln."
        },
        {
          title: "Sichere, durchgängige Velorouten",
          status: "In Arbeit",
          theme: "Verkehr", region: "Gemeinde",
          date: "2025-09-10",
          text: "Lücken schliessen: Schule–Bahnhof, Quartier–Zentrum. Quick Wins bis Winter, Kosten < 150’000 CHF.",
          next: "Begehung mit Tiefbau, Finanzierungsentscheid im Rat vorbereiten."
        },
        {
          title: "Energie fair: Fernwärme mit Sozialtarif",
          status: "In Arbeit",
          theme: "Energie", region: "Gemeinde",
          date: "2025-09-18",
          text: "Ausbau ja, aber bezahlbar. Fonds aus CO₂-Abgabe zur Abfederung tiefer Einkommen.",
          next: "Werkleitungsgespräch; Tarife mit Nachbargemeinden vergleichen."
        },
        {
          title: "PV-Pflicht für geeignete Dächer",
          status: "beschlossen",
          theme: "Energie", region: "Kanton Bern",
          date: "2025-08-30",
          text: "Genehmigung vereinfacht, Standard bis 30 kW. Leitfaden für Gemeinden folgt.",
          next: "Leitfaden-Entwurf in KW 39 (öffentliche Konsultation)."
        },
        {
          title: "ÖV verlässlicher machen",
          status: "Entwurf",
          theme: "Verkehr", region: "Region Emmental",
          date: "2025-09-05",
          text: "Taktverdichtung zu Schulstart/Feierabend, Busspuren an Engstellen, bessere Anschlüsse an S-Bahn.",
          next: "Kosten-Nutzen-Rechnung; Gespräche mit RBS/SBB ansetzen."
        },
        {
          title: "Digitale Teilhabe an Schulen",
          status: "Entwurf",
          theme: "Bildung", region: "Kanton Bern",
          date: "2025-09-02",
          text: "Bibliotheken als Lernhubs, Open-Source-Endgeräteverwaltung, Datensparsamkeit.",
          next: "Pilot mit zwei Oberstufen – Evaluation didaktisch/technisch."
        }
      ]
    };

    const $ = s => document.querySelector(s);
    function el(tag, attrs={}, children=[]){
      const n=document.createElement(tag);
      for(const [k,v] of Object.entries(attrs)){
        if(k==="class") n.className=v;
        else if(k==="dataset"){ for(const [dk,dv] of Object.entries(v)) n.dataset[dk]=dv; }
        else if(k.startsWith("on") && typeof v==="function"){ n.addEventListener(k.slice(2), v); }
        else if(v!==null && v!==undefined){ n.setAttribute(k,v); }
      }
      (Array.isArray(children)?children:[children]).forEach(c=>n.appendChild(typeof c==="string"?document.createTextNode(c):c));
      return n;
    }

    const state = { q:"", themes:new Set(["Bildung","Verkehr","Energie"]), status:new Set() };

    function chip(label, group){
      const c=el("button",{class:"chip","aria-pressed":state[group]?.has && state[group].has(label)?"true":"false"},label);
      c.addEventListener("click",()=>{
        const pressed=c.getAttribute("aria-pressed")==="true";
        c.setAttribute("aria-pressed",pressed?"false":"true");
        const set=state[group];
        if(!pressed) set.add(label); else set.delete(label);
        render();
      });
      return c;
    }

    function buildFilters(){
      const tWrap=$("#themes"); const sWrap=$("#status");
      tWrap.innerHTML=""; sWrap.innerHTML="";
      DATA.themes.forEach(t=>tWrap.appendChild(chip(t,"themes")));
      DATA.status.forEach(s=>sWrap.appendChild(chip(s,"status")));
    }

    function buildTimeline(){
      const z=$("#zeitspur"); if(!z) return; z.innerHTML="";
      DATA.timeline.forEach(item=>z.appendChild(el("div",{class:"pill"},`${item.date} – ${item.text}`)));
    }

    // ICS Helfer
    function pad(n){return n.toString().padStart(2,'0')}
    function toUTCStr(d){return `${d.getUTCFullYear()}${pad(d.getUTCMonth()+1)}${pad(d.getUTCDate())}T${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}${pad(d.getUTCSeconds())}Z`}
    function parseLocalDateTime(dateStr,timeStr){const [Y,M,D]=(dateStr||"").split("-").map(Number);const [h,mi]=(timeStr||"09:00").split(":").map(Number);return new Date(Y,(M||1)-1,D||1,h||9,mi||0,0)}
    function escapeICS(s){return (s||"").replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}
    function makeICSBlob(item){
      const startLocal=parseLocalDateTime(item.date,item.time);
      const endLocal=new Date(startLocal.getTime()+60*60*1000);
      const ics=[
        "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//JG Brugg//Agenda//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",
        `UID:${Date.now()}-${Math.random().toString(36).slice(2)}@jg.brugg`,
        `DTSTAMP:${toUTCStr(new Date())}`,`DTSTART:${toUTCStr(startLocal)}`,`DTEND:${toUTCStr(endLocal)}`,
        `SUMMARY:${escapeICS(item.title||"Termin")}`,
        `DESCRIPTION:${escapeICS(item.purpose||"")}`,
        `LOCATION:${escapeICS(item.place||"Brugg")}`,
        `URL:${escapeICS(item.ctaHref||window.location.href)}`,
        "END:VEVENT","END:VCALENDAR"].join("\r\n");
      return new Blob([ics],{type:"text/calendar;charset=utf-8"});
    }

    function formatCHDate(dateStr,timeStr){
      const d=parseLocalDateTime(dateStr,timeStr);
      const fmt=new Intl.DateTimeFormat('de-CH',{weekday:'long',day:'2-digit',month:'long',year:'numeric'});
      const [hh,mm]=(timeStr||'09:00').split(':'); return `${fmt.format(d)}, ${hh}.${mm} Uhr`;
    }

    function renderAgenda(){
      const host=$("#miniAgenda"); if(!host) return; host.innerHTML="";
      const items=(DATA.agenda||[]).slice(0,3);
      if(items.length===0){
        host.appendChild(el("div",{class:"agenda-item"},[el("div",{class:"agenda-date"},"—"),el("div",{class:"agenda-meta"},"Noch keine Termine publiziert.")]));
        return;
      }
      items.forEach(it=>{
        const human=formatCHDate(it.date,it.time);
        const dtAttr=`${it.date}T${(it.time||'09:00')}:00`;
        const where=it.place?el("div",{class:"where"},it.place):null;
        const purpose=it.purpose?el("div",{},it.purpose):null;
        const ctaLink=(it.ctaHref&&it.ctaLabel)?el("a",{href:it.ctaHref},it.ctaLabel):null;
        const icsBlob=makeICSBlob(it); const icsUrl=URL.createObjectURL(icsBlob);
        const icsName=`JG_${(it.title||"Termin").replace(/\s+/g,'_')}_${it.date||"datum"}.ics`;
        const icsLink=el("a",{href:icsUrl,download:icsName,"aria-label":`Kalendereintrag herunterladen: ${it.title||'Termin'} – ${human}`},"Kalendereintrag (.ics)");
        const ctaWrap=el("div",{class:"agenda-cta"},[ctaLink,icsLink].filter(Boolean));
        host.appendChild(el("div",{class:"agenda-item"},[
          el("div",{class:"agenda-date"},el("time",{datetime:dtAttr},human)),
          el("div",{class:"agenda-meta"},[el("div",{},it.title||""),where,purpose,ctaWrap].filter(Boolean))
        ]));
      });
    }

    function renderTransparency(){
      const ul=$("#transparencyList"); if(!ul) return; ul.innerHTML="";
      const links=DATA.transparency||[]; if(links.length===0) return;
      links.forEach(d=>{const parts=[]; if(d.title) parts.push(d.title); const meta=[]; if(d.source) meta.push(d.source); if(d.date) meta.push(d.date);
        if(meta.length) parts.push(`(${meta.join(" · ")})`); ul.appendChild(el("li",{}, el("a",{href:d.href||"#"},parts.join(" "))));});
    }

    function statusClass(s){return s==="Entwurf"?"status-entwurf":s==="In Arbeit"?"status-inarbeit":s==="beschlossen"?"status-beschlossen":""}
    function label(text,cls=""){return el("span",{class:"label "+cls},text)}
    function match(c){
      const q=state.q.trim().toLowerCase();
      const tOK=state.themes.size===0||state.themes.has(c.theme);
      const sOK=state.status.size===0||state.status.has(c.status);
      const qOK=!q||[c.title,c.text,c.theme,c.region,c.status].join(" ").toLowerCase().includes(q);
      return tOK&&sOK&&qOK;
    }

    function card(c){
      const meta=el("div",{class:"meta"},[
        label(c.status,"status-"+statusClass(c.status).split("-")[1]),
        label(c.theme,"them"),
        label(c.region||"","region"),
        label(c.date,"date"),
      ]);
      const body=el("div",{class:"body"},[
        el("h3",{},c.title),meta,el("p",{},c.text),el("p",{class:"next"},"Nächster Schritt: "+c.next)
      ]);
      const media=c.media?el("div",{class:"media"+(c.square?" square":"")},el("img",{src:c.media,alt:c.alt||""})):null;
      const actions=el("div",{class:"actions"},[el("button",{class:"ghost","aria-label":"Als PDF drucken",onclick:()=>window.print()},"PDF-Ansicht")]);
      return el("article",{class:"card",role:"article","aria-label":c.title},[media,body,actions]);
    }

    function render(){
      const host=$("#masonry"); host.setAttribute("aria-busy","true"); host.innerHTML="";
      DATA.cards.filter(match).forEach(c=>host.appendChild(card(c)));
      host.setAttribute("aria-busy","false");
    }

    // Suche / CTAs
    $("#search").addEventListener("input",e=>{state.q=e.target.value||"";render()});
    $("#mitmachenBtn").addEventListener("click",()=>alert("Mitmachen: kurzes Formular (Demo)."));
    $("#newsletterBtn").addEventListener("click",()=>alert("Newsletter: DSG-konformer Versand (Demo)."));

    // Init
    buildFilters(); buildTimeline(); renderAgenda(); renderTransparency(); render();
  </script>

</body>
</html>
