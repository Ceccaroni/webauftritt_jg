<!doctype html>
<html lang="de-CH">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Geordnete Wildheit – Start</title>
  <meta name="description" content="Seriöser, barrierearmer Auftritt einer Grünen-Politikerin mit lebendigem Kartenraster und klaren Filtern.">
  <style>
    :root{--brand:#84B414;--brand-ink:#ffffff;--brand-dark:#5a8f00;--bg:#f6f8f5;--paper:#ffffff;--ink:#1a1a1a;--muted:#5d5d5d;--border:#e0e4da;--focus:#0b5fff;--radius:12px;--shadow:0 1px 2px rgba(0,0,0,.05),0 8px 24px rgba(0,0,0,.08);--col-gap:1.25rem;--maxw:1120px;--header-h:72px;--agenda-date-w:330px}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font:400 17px/1.55 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif;color:var(--ink);background:var(--bg)}
    a{color:#0a66c2;text-decoration:none} a:hover{text-decoration:underline}
    img{max-width:100%;height:auto;display:block}
    .skip-link{position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{left:1rem;top:1rem;padding:.5rem .75rem;background:#fff;border:2px solid var(--focus);border-radius:6px;z-index:1000}
    :focus{outline:none} :focus-visible{outline:3px solid var(--focus);outline-offset:2px}
    .btn:focus-visible,.chip:focus-visible,.search input:focus-visible{box-shadow:0 0 0 3px rgba(11,95,255,.25)}

    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border);backdrop-filter:saturate(1.1) blur(6px)}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 1rem}
    .brandbar{position:relative;display:grid;grid-template-columns:1fr auto;align-items:center;gap:1rem;min-height:var(--header-h)}
    .brand{display:flex;align-items:center;gap:.75rem}
    .brand .mark{width:40px;height:40px;border-radius:10px;background:var(--brand);box-shadow:inset 0 0 0 2px #fff,0 1px 2px rgba(0,0,0,.08)}
    .brand h1{margin:0;font-size:1.1rem;font-weight:700;letter-spacing:.2px}
    .cta{display:flex;gap:.5rem}
    .btn{appearance:none;border:1px solid transparent;border-radius:999px;padding:.6rem .95rem;font-weight:650;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{background:var(--brand-dark);color:var(--brand-ink)} .btn.primary:hover{filter:brightness(.98)}
    .btn.secondary{background:#fff;color:#000;border:1px solid var(--border)}

    /* Hero */
    .hero{background:transparent;border-bottom:none}
    .hero-grid{display:grid;grid-template-columns:1.2fr .8fr;gap:1rem;align-items:start;padding:1.25rem 0}
    .hero h2{margin:.25rem 0 .25rem 0;font-size:1.45rem}
    .hero p{margin:.25rem 0 0 0;color:#2c2c2c;max-width:70ch}
    .tile{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:.9rem}
    .hero-copy{display:grid;gap:.75rem}

    /* Featured */
    .featured{display:grid;grid-template-columns:96px 1fr;gap:.75rem;align-items:center}
    .featured .thumb img{width:96px;height:96px;object-fit:cover;border-radius:10px;border:1px solid var(--border)}
    .featured .labels{display:flex;gap:.4rem;flex-wrap:wrap;margin:.15rem 0}
    .label{font-size:.78rem;padding:.2rem .5rem;border-radius:999px;border:1px solid var(--border);background:#fff;color:#333}
    .label.bereich{background:#f1f7ea;border-color:#e0e4da}
    .label.region{background:#f4f6f8}
    .label.date{background:#fff;color:#666}

    /* Über mich */
    .about{display:none;margin:.25rem 0 0 0}
    .about.is-visible{display:block}
    .about-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;align-items:start;padding:.75rem 0}
    .about .tile{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:1rem}
    .about .portrait{aspect-ratio:3/4;border-radius:12px;object-fit:cover}

    /* Filter + Grid */
    .filters{display:grid;grid-template-columns:1fr auto auto;gap:.75rem;align-items:end;margin-top:.75rem}
    .search{display:flex;gap:.5rem;align-items:center}
    .search input{width:100%;padding:.65rem .85rem;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:1rem}
    .chips{display:flex;flex-wrap:wrap;gap:.5rem}
    .chip{padding:.45rem .75rem;border:1px solid var(--border);border-radius:999px;background:#fff;color:#222;cursor:pointer;font-size:.95rem;transition:transform .16s ease, background .16s ease, color .16s ease}
    .chip[aria-pressed="true"]{background:var(--brand-dark);color:var(--brand-ink);border-color:transparent;transform:translateY(-1px)}

    .masonry{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:var(--col-gap);align-items:start;margin:1rem auto 2rem auto;position:relative}
    .card{break-inside:avoid;background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);margin:0;box-shadow:var(--shadow);overflow:hidden;width:100%}
    .card .body{padding:.95rem}
    .card h3{margin:.1rem 0 .35rem 0;font-size:1.1rem;line-height:1.3}
    .meta{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;margin:.25rem 0 .6rem 0}
    .body p{margin:.25rem 0 .55rem 0}
    .body .next{margin-top:.55rem;font-size:.95rem;color:#1f3d1f}
    .actions{display:flex;gap:.5rem;padding:.75rem .95rem;border-top:1px solid var(--border);background:#fafbfc}
    .actions .ghost{appearance:none;background:#fff;border:1px solid var(--border);border-radius:8px;padding:.48rem .7rem;font-size:.95rem;cursor:pointer}
    .empty{padding:1rem;border:1px dashed var(--border);border-radius:10px;background:#fff;color:#2b2b2b}
    .card .media img{width:100%;height:auto;display:block;aspect-ratio:16/9;object-fit:cover}
    .card .media.square img{aspect-ratio:1/1}

    footer{border-top:1px solid var(--border);background:#fff}
    .transparenz{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));padding:1rem 0}
    .tcard{background:#fff;border:1px solid var(--border);border-radius:var(--radius);padding:.8rem;box-shadow:var(--shadow)}
    .small{color:#5d5d5d;font-size:.9rem}
    .tlist{margin:.5rem 0 0 0;padding-left:1.1rem} .tlist li{margin:.25rem 0}

    @media (prefers-reduced-motion: reduce){ .card, .chip{transition:none !important} }

    @media print{
      body{background:#fff;color:#000}
      .hero,.about,.filters,.actions{display:none !important}
      .masonry{grid-template-columns:repeat(2,1fr) !important}
      .card{border-color:#000;box-shadow:none}
      .label{background:#fff !important;border-color:#000;color:#000}
      a{color:#000;text-decoration:underline}
    }

    .party-badge{position:absolute;right:0;top:12px;z-index:60;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:.35rem;display:flex;align-items:center}
    .party-badge img{height:28px;width:auto;display:block}
    @media(max-width:720px){.party-badge{position:static;margin:.5rem 0 0 0} header .brandbar{grid-template-columns:auto auto}}
    .brandbar.badge-collide{padding-right:112px}
    @media(max-width:720px){.brandbar.badge-collide{padding-right:0}}

    @media(max-width:720px){
      .hero-grid{grid-template-columns:1fr;gap:.75rem;padding:.8rem 0}
      .hero .tile{padding:.75rem}
      .hero h2{font-size:1.25rem;line-height:1.25}
      .brandbar{align-items:start}
      .filters{grid-template-columns:1fr;gap:.6rem;align-items:stretch}
      .chips{overflow:auto;gap:.45rem;padding-bottom:.25rem;scroll-snap-type:x mandatory}
      .chips .chip{flex:0 0 auto;scroll-snap-align:start}
      .chips::-webkit-scrollbar{display:none}
      .masonry{margin:.5rem auto 1.25rem auto}
      .about-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Zum Inhalt springen</a>

  <header role="banner">
    <div class="wrap brandbar badge-collide">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <h1>Geordnete Wildheit</h1>
      </div>
      <nav class="cta" aria-label="Hauptaktionen">
        <button class="btn secondary" id="aboutBtn" aria-controls="ueber-mich" aria-expanded="false">Über mich</button>
        <button class="btn primary" id="mitmachenBtn" aria-label="Mitmachen">Mitmachen</button>
        <button class="btn secondary" id="newsletterBtn" aria-label="Newsletter">Newsletter</button>
      </nav>

      <div class="party-badge" aria-hidden="true">
        <img src="https://grueneaargau.ch/wp-content/uploads/sites/2/2020/06/Gruene_AG_Logo_RGB-e1591108033630-2560x0-c-default.png" alt="" loading="lazy"
             onerror="this.onerror=null;this.src='assets/logos/logo-gruene-placeholder.svg';">
      </div>
    </div>
  </header>

  <main id="main" class="wrap" role="main">
    <!-- Hero -->
    <section class="hero" aria-label="Einstieg">
      <div class="hero-grid wrap">
        <div class="hero-copy">
          <h2>„Politik, die wirkt. Heute Entscheidungen treffen, die morgen tragen.“</h2>
          <p>Schwerpunkt: <strong>Bildung</strong>, <strong>Verkehr</strong>, <strong>Energie</strong>. Transparent, nachvollziehbar, messbar.</p>

          <!-- Featured -->
          <div id="featuredHost" class="tile" style="display:none" aria-label="Top-Beitrag"></div>

          <!-- LIVE-BOX -->
          <div class="tile" aria-label="Aktuelles Update">
            <h3>Diese Woche erledigt</h3>
            <div id="liveList" class="live-list" aria-live="polite"></div>
            <form id="gapForm" class="search" style="margin-top:.6rem" aria-label="Sag mir die nächste Lücke">
              <input id="gapInput" type="text" placeholder="Sag mir die nächste Lücke … (Ort, Problem)" aria-label="Nächste Lücke melden">
              <button class="btn secondary" type="submit">Senden</button>
            </form>
          </div>

          <!-- Nächste Termine: wieder als Kachel -->
          <div class="tile mini-agenda" aria-label="Nächste Termine in Brugg">
            <h3>Nächste Termine in Brugg</h3>
            <div id="miniAgenda" class="agenda-list" aria-live="polite"></div>
          </div>
        </div>

        <div class="tile hero-portrait" aria-label="Porträt">
          <a href="assets/images/julia-grieder-portraet.png" target="_blank" rel="noopener" aria-label="Porträt in neuem Tab öffnen">
            <img src="assets/images/julia-grieder-portraet.png" alt="Julia Grieder, Brugg – Porträt am Aareufer." loading="eager"
                 onerror="this.onerror=null;this.src='assets/image-placeholder-3x4.svg';">
          </a>
        </div>
      </div>
    </section>

    <!-- Über mich -->
    <section id="ueber-mich" class="about" aria-label="Über mich">
      <div class="about-grid wrap">
        <div class="tile">
          <h3>Über mich</h3>
          <p>Ich heisse <strong>Julia Grieder</strong> und lebe in Brugg. Ich arbeite an Lösungen in <strong>Bildung</strong>, <strong>Verkehr</strong> und <strong>Energie</strong> – konkret vor Ort, nachvollziehbar und messbar.</p>
          <p><em>Nächster Schritt:</em> Sprechstunde jeweils Donnerstag 18–19 Uhr (Ort folgt).</p>
        </div>
        <div class="tile">
          <img class="portrait" src="assets/images/julia-grieder-quad.jpg" alt="" loading="lazy"
               onerror="this.onerror=null;this.src='assets/image-placeholder-3x4.svg';">
        </div>
      </div>
    </section>

    <!-- Filter -->
    <section class="filters" aria-label="Filter und Suche">
      <div class="chips" id="themes" role="group" aria-label="Themen"></div>
      <div class="chips" id="status" role="group" aria-label="Status"></div>
      <div class="search"><input id="search" type="search" placeholder="Suche" aria-label="Suche"></div>
    </section>

    <!-- Kartenraster -->
    <section class="masonry" id="masonry" aria-live="polite" aria-busy="false"></section>
  </main>

  <footer role="contentinfo">
    <div class="wrap transparenz">
      <div class="tcard">
        <h3>Transparenz</h3>
        <p class="small">Quellen, Abstimmungsverhalten, Sitzungstermine. Veröffentlichung quartalsweise.</p>
        <ul id="transparencyList" class="tlist" aria-label="Belege und Quellen"></ul>
      </div>
      <div class="tcard">
        <h3>Was als Nächstes kommt</h3>
        <p class="small">Energie-Leitfaden Gemeinde, Dossier „Mobilität sicher & flüssig“, Bildung: Entlastung Lehrpersonen.</p>
      </div>
      <div class="tcard">
        <h3>Kontakt</h3>
        <p class="small">Anliegen kurz schildern. Antwort in der Regel binnen 72h.</p>
      </div>
    </div>
  </footer>

  <!-- JSON-LD (Beispiel) -->
  <script type="application/ld+json" id="events-jsonld">{
    "@context":"https://schema.org","@graph":[
      {"@type":"Event","name":"Veloroute-Spotcheck Ost","startDate":"2025-09-26T18:30:00+02:00","eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode","eventStatus":"https://schema.org/EventScheduled","location":{"@type":"Place","name":"Bahnhof Brugg","address":{"@type":"PostalAddress","addressLocality":"Brugg","addressCountry":"CH"}},"description":"Lückenanalyse und Quick Wins priorisieren.","organizer":{"@type":"Person","name":"Julia Grieder"},"url":"https://example.ch/termine/veloroute-spotcheck-ost"}]}</script>

  <script>
    // Backticks entsorgen
    document.addEventListener('DOMContentLoaded', () => {
      const w = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);
      const kill=[]; while(w.nextNode()){ const n=w.currentNode; if(n.nodeValue && n.nodeValue.trim()==='```') kill.push(n); }
      kill.forEach(n => n.remove());
    });

    const $ = s => document.querySelector(s);
    function el(tag, attrs={}, children=[]){
      const n=document.createElement(tag);
      for(const [k,v] of Object.entries(attrs)){
        if(k==="class") n.className=v;
        else if(k==="dataset"){ for(const [dk,dv] of Object.entries(v)) n.dataset[dk]=dv; }
        else if(k.startsWith("on")&&typeof v==="function"){ n.addEventListener(k.slice(2),v); }
        else if(v!==null && v!==undefined){ n.setAttribute(k,v); }
      }
      (Array.isArray(children)?children:[children]).forEach(c=>n.appendChild(typeof c==="string"?document.createTextNode(c):c));
      return n;
    }
    function parseLocalDate(dateStr){const [Y,M,D]=(dateStr||"").split("-").map(Number);return new Date(Y,(M||1)-1,(D||1));}
    function formatCHDateLong(dateStr){
      const d=parseLocalDate(dateStr);
      const fmt=new Intl.DateTimeFormat('de-CH',{weekday:'long',day:'2-digit',month:'long',year:'numeric'});
      const s=fmt.format(d);
      return s.charAt(0).toUpperCase()+s.slice(1);
    }

    const STATE = { data:null, q:"", themes:new Set(), status:new Set(), themeOrder:[] };

    // Chips
    function chip(label, group){
      const active = STATE[group]?.has && STATE[group].has(label);
      const c=el("button",{class:"chip","aria-pressed":active?"true":"false"},label);
      c.addEventListener("click",()=>{
        const pressed=c.getAttribute("aria-pressed")==="true";
        const set=STATE[group];
        if(pressed){
          set.delete(label); c.setAttribute("aria-pressed","false");
          if(group==="themes"){ STATE.themeOrder = STATE.themeOrder.filter(t => t!==label); }
        }else{
          set.add(label); c.setAttribute("aria-pressed","true");
          if(group==="themes"){ STATE.themeOrder = [label, ...STATE.themeOrder.filter(t => t!==label)]; }
        }
        render();
      });
      return c;
    }
    function buildFilters(){
      const tWrap=$("#themes"); const sWrap=$("#status");
      tWrap.innerHTML=""; sWrap.innerHTML="";
      (STATE.data?.themes||[]).forEach(t=>tWrap.appendChild(chip(t,"themes")));
      (STATE.data?.status||[]).forEach(s=>sWrap.appendChild(chip(s,"status")));
    }

    // Agenda / ICS
    const pad=n=>n.toString().padStart(2,'0');
    function toUTCStr(d){return `${d.getUTCFullYear()}${pad(d.getUTCMonth()+1)}${pad(d.getUTCDate())}T${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}${pad(d.getUTCSeconds())}Z`}
    function parseLocalDateTime(dateStr,timeStr){const [Y,M,D]=(dateStr||"").split("-").map(Number);const [h,mi]=(timeStr||"09:00").split(":").map(Number);return new Date(Y,(M||1)-1,D||1,h||9,mi||0,0)}
    function escapeICS(s){return (s||"").replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}
    function makeICSBlob(item){
      const startLocal=parseLocalDateTime(item.date,item.time);
      const endLocal=new Date(startLocal.getTime()+60*60*1000);
      const ics=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//JG Brugg//Agenda//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",
        `UID:${Date.now()}-${Math.random().toString(36).slice(2)}@jg.brugg`,
        `DTSTAMP:${toUTCStr(new Date())}`,`DTSTART:${toUTCStr(startLocal)}`,`DTEND:${toUTCStr(endLocal)}`,
        `SUMMARY:${escapeICS(item.title||"Termin")}`,`DESCRIPTION:${escapeICS(item.purpose||"")}`,
        `LOCATION:${escapeICS(item.place||"Brugg")}`,`URL:${escapeICS(item.ctaHref||window.location.href)}`,
        "END:VEVENT","END:VCALENDAR"].join("\r\n");
      return new Blob([ics],{type:"text/calendar;charset=utf-8"});
    }
    function formatCHDate(dateStr,timeStr){
      const d=parseLocalDateTime(dateStr,timeStr);
      const fmt=new Intl.DateTimeFormat('de-CH',{weekday:'long',day:'2-digit',month:'long',year:'numeric'});
      const [hh,mm]=(timeStr||'09:00').split(':');
      const s=fmt.format(d); return s.charAt(0).toUpperCase()+s.slice(1)+`, ${hh}.${mm} Uhr`;
    }
    function renderAgenda(){
      const host=$("#miniAgenda"); if(!host) return; host.innerHTML="";
      const items=(STATE.data?.agenda||[]).slice(0,1);
      if(items.length===0){host.appendChild(el("div",{class:"agenda-item"},[el("div",{class:"agenda-date"},"—"),el("div",{class:"agenda-meta"},"Noch keine Termine publiziert.") ]));return;}
      items.forEach(it=>{
        const human=formatCHDate(it.date,it.time); const dtAttr=`${it.date}T${(it.time||'09:00')}:00`;
        const where=it.place?el("div",{class:"where"},it.place):null; const purpose=it.purpose?el("div",{},it.purpose):null;
        const ctaLink=(it.ctaHref&&it.ctaLabel)?el("a",{href:it.ctaHref},it.ctaLabel):null;
        const icsLink=(()=>{const b=makeICSBlob(it);const url=URL.createObjectURL(b);const name=`JG_${(it.title||"Termin").replace(/\s+/g,'_')}_${it.date||"datum"}.ics`;return el("a",{href:url,download:name,"aria-label":`Kalendereintrag herunterladen: ${it.title||'Termin'} – ${human}`},"Kalendereintrag (.ics)")})();
        const ctaWrap=el("div",{class:"agenda-cta"},[ctaLink,icsLink].filter(Boolean));
        host.appendChild(el("div",{class:"agenda-item"},[
          el("div",{class:"agenda-date"},el("time",{datetime:dtAttr},human)),
          el("div",{class:"agenda-meta"},[el("div",{},it.title||""),where,purpose,ctaWrap].filter(Boolean))
        ]));
      });
    }

    // Karten
    function label(text,cls=""){return el("span",{class:"label "+cls},text)}
    function matchesFilters(c){
      const q=STATE.q.trim().toLowerCase();
      const tOK = STATE.themes.size===0 ? false : STATE.themes.has(c.theme);
      const sOK = STATE.status.size===0 || STATE.status.has(c.status||"");
      const qOK=!q||[c.title,c.text,c.theme,c.region].join(" ").toLowerCase().includes(q);
      return tOK && sOK && qOK;
    }
    function sortCards(a,b){
      const ia = STATE.themeOrder.indexOf(a.theme);
      const ib = STATE.themeOrder.indexOf(b.theme);
      if(ia!==ib) return ia-ib;
      return (b.date||"").localeCompare(a.date||"");
    }
    function card(c){
      const meta=el("div",{class:"meta"},[
        label(c.theme,"bereich"),
        label(c.region||"","region"),
        label(formatCHDateLong(c.date),"date"),
      ]);
      const body=el("div",{class:"body"},[
        el("h3",{},c.title), meta,
        el("p",{},c.text),
        el("p",{class:"next"},"Nächster Schritt: "+(c.next||"–"))
      ]);
      let media=null;
      if(c.media){
        const img = el("img",{
          src:c.media, alt:c.alt||"",
          onerror:(e)=>{ e.currentTarget.onerror=null; e.currentTarget.src='assets/image-placeholder-16x9.svg'; }
        });
        const a = el("a",{href:c.media,target:"_blank",rel:"noopener","aria-label":"Bild in neuem Tab öffnen"},img);
        media = el("div",{class:"media"+(c.square?" square":"")},a);
      }
      const actions=el("div",{class:"actions"},[
        el("button",{class:"ghost","aria-label":"Als PDF drucken",onclick:()=>window.print()},"PDF-Ansicht")
      ]);
      return el("article",{class:"card",role:"article","aria-label":c.title, id:c.id||("c-"+Math.random().toString(36).slice(2))},[media,body,actions]);
    }
    function render(){
      const host=$("#masonry");
      host.setAttribute("aria-busy","true");
      const list = (STATE.data?.cards||[]).filter(matchesFilters).sort(sortCards);
      host.innerHTML="";
      if(list.length===0){
        const msg = STATE.themes.size===0 ? "Bitte ein Thema auswählen." : "Kein Ergebnis – Filter anpassen.";
        host.appendChild(el("div",{class:"empty","role":"status","aria-live":"polite"}, msg));
        host.setAttribute("aria-busy","false"); return;
      }
      list.forEach(c => host.appendChild(card(c)));
      host.setAttribute("aria-busy","false");
    }

    // Featured oben neben Porträt
    function renderFeatured(){
      const host = $("#featuredHost");
      if(!host || !STATE.data) return;
      const candidates = (STATE.data.cards||[]).filter(c => c.featured===true);
      if(candidates.length===0){ host.style.display='none'; host.innerHTML=''; return; }
      candidates.sort((a,b)=> (b.date||"").localeCompare(a.date||""));
      const f = candidates[0];
      const thumb = f.media ? el("div",{class:"thumb"}, el("img",{src:f.media,alt:f.alt||"",loading:"lazy",
        onerror:(e)=>{e.currentTarget.onerror=null; e.currentTarget.src='assets/image-placeholder-1x1.svg';}})) : el("div",{class:"thumb"});
      const labels = el("div",{class:"labels"},[
        label(f.theme,"bereich"),
        label(f.region||"","region"),
        label(formatCHDateLong(f.date),"date")
      ]);
      const title = el("h3",{}, f.title);
      const p = el("p",{}, f.text);
      const box = el("div",{class:"featured"},[thumb, el("div",{},[title, labels, p])]);
      host.innerHTML=""; host.appendChild(box); host.style.display='';
    }

    // Live-Box (letztes 30 Tage)
    function parseDateFlexible(iso){if(!iso) return null; const m=/^(\d{4})-(\d{2})-(\d{2})$/.exec(iso.trim()); if(m){return new Date(+m[1],+m[2]-1,+m[3]);} const d=new Date(iso); return isNaN(d)?null:d;}
    function withinLastDays(iso,days=30){const d=parseDateFlexible(iso); if(!d) return false; const now=new Date(); const ms=days*24*60*60*1000; return (now-d)>=0 && (now-d)<=ms;}
    function renderLive(){
      const host=$("#liveList"); if(!host) return; host.innerHTML="";
      const recent=(STATE.data?.cards||[]).filter(c=>withinLastDays(c.date,30)).sort((a,b)=> (b.date||"").localeCompare(a.date||"")).slice(0,1);
      if(recent.length===0){
        host.appendChild(el("div",{class:"live-item"},[
          el("div",{},"Kein Update in diesem Monat."),
          el("div",{class:"stamp"},"Stand: "+ new Intl.DateTimeFormat('de-CH',{dateStyle:'medium'}).format(new Date()))
        ])); return;
      }
      const c=recent[0];
      host.appendChild(el("div",{class:"live-item"},[
        el("strong",{}, c.title),
        el("div",{class:"stamp"}, `${c.theme} · ${c.region||''} · ${formatCHDateLong(c.date)}`),
        el("div",{}, c.text),
        el("div",{class:"proof"},"Nächster Schritt: " + (c.next||"–"))
      ]));
    }

    // About / Suche
    const aboutBtn = $("#aboutBtn");
    const aboutSection = $("#ueber-mich");
    function setAbout(v){aboutSection.classList.toggle("is-visible", v);aboutBtn.setAttribute("aria-expanded", String(v)); if(v){history.replaceState(null,"","#ueber-mich");aboutSection.scrollIntoView({behavior:"smooth", block:"start"});}else{history.replaceState(null,"", location.pathname + location.search);aboutBtn.focus();}}
    function toggleAbout(){ setAbout(!aboutSection.classList.contains("is-visible")); }
    function maybeOpenFromHash(){ setAbout(location.hash === "#ueber-mich"); }
    aboutBtn.addEventListener("click", toggleAbout);
    window.addEventListener("hashchange", maybeOpenFromHash);
    $("#search").addEventListener("input", e => { STATE.q = e.target.value || ""; render(); });
    $("#mitmachenBtn").addEventListener("click", () => alert("Mitmachen: kurzes Formular (Demo)."));
    $("#newsletterBtn").addEventListener("click", () => alert("Newsletter: DSG-konformer Versand (Demo)."));

    // Transparenz
    function renderTransparency(){
      const ul=$("#transparencyList"); if(!ul) return; ul.innerHTML="";
      (STATE.data?.transparency||[]).forEach(d=>{const t=d.title||d.href||"Link"; ul.appendChild(el("li",{},el("a",{href:d.href||"#"},t)))});}

    // Daten laden
    async function loadData(){
      try{
        const res = await fetch('./assets/content.json', {cache:'no-store'});
        const json = await res.json();
        STATE.data = json;
      }catch(e){
        STATE.data = {themes:["Bildung","Verkehr","Energie","Gleichstellung","Digitalisierung","Lokales"], status:["Entwurf","In Arbeit","beschlossen"], agenda:[], transparency:[], cards:[]};
      }
      buildFilters(); renderAgenda(); renderLive(); renderFeatured(); render(); maybeOpenFromHash();
    }
    loadData();

    // Form-Handler (Demo)
    document.getElementById('gapForm')?.addEventListener('submit', e=>{
      e.preventDefault();
      const v = document.getElementById('gapInput')?.value?.trim();
      if(v){ alert("Danke! Gemeldete Lücke: "+v); (document.getElementById('gapInput').value=""); }
    });
  </script>
</body>
</html>
